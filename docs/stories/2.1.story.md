---
title: Academic Management - Course & Subject Management
status: Draft
epic: 2
story: 1
---

# User Story: As a Tenant Admin, I want to create and manage courses and subjects with support for different academic levels (Primary, O-Level, A-Level) and subject types (Core, Optional, Combination), so that I can organize the academic structure of my school according to Tanzanian education standards.

## Acceptance Criteria:
- The system shall allow a Tenant Admin to create courses with course codes, descriptions, and credits.
- The system shall allow a Tenant Admin to create subjects with support for different academic levels (Primary, O-Level, A-Level, University).
- The system shall allow a Tenant Admin to define subject types (Core, Optional, Combination) for NECTA compliance.
- The system shall ensure that subjects with the same name but different academic levels are uniquely identified.
- The system shall prevent unauthorized access to academic data based on tenant isolation.
- The system shall support the assignment of teachers to specific subjects within their tenant.

## Dev Notes:

### Previous Story Insights:
- User & Role Management (Story 1.1) provides the foundation for multi-tenant authentication and authorization
- Tenant isolation is implemented using `tenant_id` discriminator column
- RBAC system supports Super Admin, Tenant Admin, Teacher, Student, Parent, and Staff roles
- JWT authentication and secure API endpoints are established

### Data Models:
- **Courses Table:** Course details including course codes, descriptions, credits, and tenant-specific configuration
- **Subjects Table:** Subject management with `subject_level` (Primary, O-Level, A-Level, University) and `subject_type` (Core, Optional, Combination) attributes
- **Course_Subjects Table:** Many-to-many relationship between courses and subjects
- **Teacher_Subjects Table:** Assignment of teachers to specific subjects within their tenant
- **Academic_Years Table:** Management of academic years, terms, and semesters per tenant

### API Specifications:
- **RESTful APIs:** Course and subject CRUD operations with proper validation
- **Authentication:** JWT-based authentication with tenant isolation
- **Authorization:** Role-based access control ensuring only authorized users can manage academic data
- **Validation:** Input validation for course codes, subject names, and academic level constraints

### Component Specifications:
- **Frontend:** React components for course and subject management with Material-UI
- **Backend:** Node.js services handling academic data logic with PostgreSQL integration
- **Forms:** Course creation/editing forms with validation
- **Subject Management:** Subject creation with academic level and type selection
- **Teacher Assignment:** Interface for assigning teachers to subjects

### File Locations:
- Frontend components: `frontend/src/components/academic/`
- Backend API routes: `backend/routes/academic.js`
- Backend controllers: `backend/controllers/academicController.js`
- Database models: `backend/models/Course.js`, `backend/models/Subject.js`
- Database migrations: `backend/scripts/migrate-academic.js`

### Testing Requirements:
- Unit tests for course and subject CRUD operations
- Integration tests for teacher-subject assignments
- Validation tests for academic level and subject type constraints
- Multi-tenancy tests ensuring data isolation
- API endpoint tests with proper authentication and authorization

### Technical Constraints:
- **Frontend:** React with Material-UI components
- **Backend:** Node.js with Express.js
- **Database:** PostgreSQL with multi-tenant architecture
- **Authentication:** JWT with RBAC
- **Validation:** Express-validator for input validation
- **NECTA Compliance:** Support for Tanzanian education system requirements

### NECTA-Specific Requirements:
- **O-Level Subjects:** Support for 'recommended' (core) and 'choice' subjects
- **A-Level Subjects:** Support for 'combination' subjects (EGM, PCB, HKL) and 'recommended' subjects
- **Subject Leveling:** Unique identification of subjects across different academic levels
- **Division Calculation:** Preparation for NECTA grading system integration

## Tasks / Subtasks:

- [ ] Task 1 (AC: 1): Implement course creation with course codes, descriptions, and credits.
- [ ] Task 2 (AC: 2): Implement subject creation with academic level support (Primary, O-Level, A-Level, University).
- [ ] Task 3 (AC: 3): Implement subject type definition (Core, Optional, Combination) for NECTA compliance.
- [ ] Task 4 (AC: 4): Ensure unique subject identification across academic levels.
- [ ] Task 5 (AC: 5): Implement tenant isolation for academic data.
- [ ] Task 6 (AC: 6): Implement teacher-subject assignment functionality.

## Database Schema Extensions:

```sql
-- Courses table
CREATE TABLE courses (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL,
    course_code VARCHAR(20) NOT NULL,
    course_name VARCHAR(255) NOT NULL,
    description TEXT,
    credits INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    updated_by UUID REFERENCES users(id),
    UNIQUE(tenant_id, course_code)
);

-- Subjects table
CREATE TABLE subjects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL,
    subject_name VARCHAR(255) NOT NULL,
    subject_code VARCHAR(20),
    subject_level VARCHAR(20) NOT NULL CHECK (subject_level IN ('Primary', 'O-Level', 'A-Level', 'University')),
    subject_type VARCHAR(20) NOT NULL CHECK (subject_type IN ('Core', 'Optional', 'Combination')),
    description TEXT,
    credits INTEGER DEFAULT 0,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    updated_by UUID REFERENCES users(id),
    UNIQUE(tenant_id, subject_name, subject_level)
);

-- Course-Subject relationship
CREATE TABLE course_subjects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL,
    course_id UUID NOT NULL REFERENCES courses(id) ON DELETE CASCADE,
    subject_id UUID NOT NULL REFERENCES subjects(id) ON DELETE CASCADE,
    is_required BOOLEAN DEFAULT true,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    UNIQUE(tenant_id, course_id, subject_id)
);

-- Teacher-Subject assignment
CREATE TABLE teacher_subjects (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL,
    teacher_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    subject_id UUID NOT NULL REFERENCES subjects(id) ON DELETE CASCADE,
    assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    assigned_by UUID REFERENCES users(id),
    UNIQUE(tenant_id, teacher_id, subject_id)
);

-- Academic Years
CREATE TABLE academic_years (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    tenant_id UUID NOT NULL,
    year_name VARCHAR(50) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    is_current BOOLEAN DEFAULT false,
    status VARCHAR(20) DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by UUID REFERENCES users(id),
    updated_by UUID REFERENCES users(id),
    UNIQUE(tenant_id, year_name)
);
```

## API Endpoints:

### Courses
- `GET /api/courses` - Get all courses for tenant
- `GET /api/courses/:id` - Get course by ID
- `POST /api/courses` - Create new course
- `PUT /api/courses/:id` - Update course
- `DELETE /api/courses/:id` - Delete course

### Subjects
- `GET /api/subjects` - Get all subjects for tenant
- `GET /api/subjects/:id` - Get subject by ID
- `POST /api/subjects` - Create new subject
- `PUT /api/subjects/:id` - Update subject
- `DELETE /api/subjects/:id` - Delete subject

### Teacher Assignments
- `GET /api/teacher-subjects` - Get teacher-subject assignments
- `POST /api/teacher-subjects` - Assign teacher to subject
- `DELETE /api/teacher-subjects/:id` - Remove teacher-subject assignment

## Dependencies:
- Requires completion of Story 1.1 (User & Role Management)
- Database migration scripts for academic tables
- Frontend routing for academic management pages
- Integration with existing authentication and authorization system
