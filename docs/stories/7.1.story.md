---
title: Finance & Fee Management
status: Draft
epic: 7
story: 1
---

# User Story: As a Tenant Admin or Accountant, I want to manage school finances, including fee structures, fee collection, and expense tracking, so that I can maintain accurate financial records.

## Acceptance Criteria:
- The system shall allow a Tenant Admin to define and manage various fee structures (e.g., tuition, admission, transport) and assign them to different classes or programs.
- The system shall support the creation of flexible installment plans for fee payments.
- The system shall allow for the assignment of fee structures to individual students, including the application of specific discounts or concessions.
- The system shall track all fee collections, support multiple payment methods (e.g., cash, bank, online), and generate receipts for payments.
- The system shall automatically generate invoices and send reminders for upcoming or overdue payments.
- The system shall provide a feature to record and categorize all school expenses.
- The system shall generate comprehensive financial reports, including fee collection summaries, outstanding fee reports, and expense reports.
- All financial data, including fee structures, payments, and expenses, must be strictly isolated by tenant.
- **The system shall provide dedicated finance and fee management panels for each user role with appropriate functionality and restrictions.**
- **Students shall only view their own fee status and payment history, with no access to financial administration or other students' data.**
- **Teachers shall have no access to financial management, fee collection, or expense tracking functions.**
- **Accountants shall have access to fee collection, payment processing, and basic financial reports within their tenant.**
- **Tenant Admins shall have full access to financial management, fee configuration, expense tracking, and comprehensive financial reports.**
- **Super Admins shall have system-wide view access to financial trends and compliance across all tenants.**

## Examples:
- **Fee Structure Setup:** The Tenant Admin creates a "Grade 5 Tuition" fee structure for the academic year. The total fee is $1,200, which can be paid in three installments of $400 each, due at the start of each term. A late fee of 5% is automatically applied to payments that are more than 10 days overdue.
- **Automated Reminder:** A student's next fee installment is due in 7 days. The system automatically sends an email to their parent: "Dear Parent, This is a friendly reminder that the next fee installment of $400 for [Student Name] is due on [Date]. You can pay online via the parent portal."

## Potential Obstacles:
- **Integration with Payment Gateways:** Integrating with third-party payment gateways can be complex. It involves handling API keys securely, processing successful and failed transactions, managing webhooks for payment confirmation, and ensuring compliance with financial regulations (like PCI DSS if card details are handled).
- **Financial Reporting Accuracy:** Financial calculations must be precise. The system needs to handle rounding, tax calculations (if applicable), and various discount scenarios without errors. Ensuring the integrity and accuracy of reports like Profit & Loss or Balance Sheets is critical.
- **Data Security:** Financial data is extremely sensitive. Protecting against unauthorized access, ensuring all transactions are logged in an immutable audit trail, and encrypting all sensitive data at rest and in transit are paramount and non-negotiable security requirements.

## Dev Notes:

### Previous Story Insights:
- User & Role Management (Story 1.1) is crucial for defining roles like 'Accountant' with specific financial permissions.
- Student & Teacher Management (Story 5.1) provides the student data to which fees are assigned.

### Data Models:
- **FeeStructures Table:** To store definitions of different fee types, amounts, and installment plans.
- **StudentFeeAssignments Table:** To link students to specific fee structures and track any individual discounts.
- **Invoices Table:** To store generated invoices for each student and payment period.
- **Payments Table:** To record all incoming fee payments against invoices.
- **Expenses Table:** To record all school expenditures.
- **FinancialReports Table:** (Or a virtual model) To aggregate data for generating reports.

## Role-Based Finance & Fee Management Access Control:

### Super Admin:
- **Access Level**: System-wide read access to financial data across all tenants
- **Permissions**: 
  - View financial trends and patterns across all schools
  - Access system-wide financial reports and analytics
  - Monitor financial compliance and policies across tenants
- **Restrictions**: Cannot manage financial operations or configure fee structures (delegated to tenant admins)

### Tenant Admin:
- **Access Level**: Full CRUD access within their tenant
- **Permissions**:
  - Configure fee structures and installment plans
  - Manage financial policies and payment methods
  - View all financial data and generate comprehensive reports
  - Manage expenses and budget tracking
  - Override financial operations when necessary
  - Access all student fee information and payment history
- **Restrictions**: Cannot access other tenants' financial data

### Accountant:
- **Access Level**: Fee collection and payment processing within their tenant
- **Permissions**:
  - Process fee payments and generate receipts
  - Record and categorize expenses
  - Generate basic financial reports
  - View student fee status and payment history
  - Manage invoice generation and reminders
- **Restrictions**: Cannot configure fee structures or access other tenants' data

### Teacher:
- **Access Level**: No access to financial management
- **Permissions**: None related to financial management
- **Restrictions**: Cannot access any financial data, fee management, or expense tracking

### Student:
- **Access Level**: Read-only access to own fee information
- **Permissions**:
  - View own fee status and payment history
  - Access personal fee invoices and receipts
  - View payment due dates and amounts
- **Restrictions**: Cannot access financial administration, other students' data, or payment processing

## Tasks / Subtasks:
- [x] Task 1 (AC: 1, 2): Implement the UI and back-end for defining fee structures and installment plans.
- [x] Task 2 (AC: 3, 4): Develop the workflow for assigning fees to students and recording payments.
- [x] Task 3 (AC: 5): Build the invoice generation and automated reminder system (e.g., using a scheduled job).
- [x] Task 4 (AC: 6): Implement the expense tracking module.
- [x] Task 5 (AC: 7): Develop the financial reporting engine to generate the required summaries and reports.
- [x] Task 6 (AC: 8): Ensure strict tenant isolation for all financial data.
- [ ] Task 7 (AC: 9): Implement role-based access control for finance and fee management APIs.
- [ ] Task 8 (AC: 10): Create role-specific finance dashboard components.
- [ ] Task 9 (AC: 11): Implement comprehensive financial data filtering based on user roles.
- [ ] Task 10 (Security): Implement robust security measures, including audit trails for all financial transactions.
- [ ] Task 11 (Future): Research and select a suitable payment gateway for future integration.
