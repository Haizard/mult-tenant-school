---
title: Library Management
status: Draft
epic: 6
story: 1
---

# User Story: As a Librarian, I want to manage the school library's collection, circulation, and fines, so that I can provide an efficient library service to students and staff.

## Acceptance Criteria:
- The system shall allow a Librarian to catalog and manage the library's collection of books and other resources, including details like title, author, ISBN, and genre.
- The system shall support the full circulation process: issuing books to users (students/teachers), recording returns, and handling renewals.
- The system shall allow the Librarian to define and enforce borrowing rules, such as borrowing periods, limits per user, and renewal policies.
- The system shall automatically track due dates and identify overdue books.
- The system shall allow a Librarian to manage library patrons (borrowers), view their borrowing history, and see currently issued books.
- The system shall have a feature to calculate and apply fines for overdue, damaged, or lost books based on configurable rules.
- The system shall provide a search interface for users to find books in the catalog.
- All library data, including the catalog, circulation records, and fines, must be strictly isolated by tenant.
- **The system shall provide dedicated library management panels for each user role with appropriate functionality and restrictions.**
- **Students shall only view available books, their own borrowing history, and cannot access library administration or other users' data.**
- **Teachers shall have extended borrowing privileges and can view their own borrowing history, but cannot access library administration.**
- **Librarians shall have full access to library management, circulation, and patron management within their tenant.**
- **Tenant Admins shall have full access to library configuration, policies, and comprehensive library reports.**
- **Super Admins shall have system-wide view access to library usage and trends across all tenants.**

## Examples:
- **Book Checkout Process:** A student brings a book to the library counter. The Librarian scans the student's ID card (or searches for their name) and then scans the book's ISBN. The system confirms the checkout, records the due date based on the school's policy (e.g., 14 days), and decrements the book's available count.
- **Overdue Fine Calculation:** A book was due on Monday. A student returns it on Wednesday. The school has a policy of $0.50 per day fine. The system automatically calculates a $1.00 fine and adds it to the student's library account.

## Potential Obstacles:
- **Integration with Barcode/RFID Scanners:** While not in the initial scope, designing the system to easily integrate with hardware like barcode scanners for quick circulation is a key consideration for future-proofing. This involves handling hardware input correctly in a web-based interface.
- **Inventory Management:** A full-fledged library system often includes complex inventory management (stock-taking) features. While the initial story focuses on circulation, the data model should be robust enough to support future inventory features without major rework.
- **User Experience for Search:** Providing a powerful and intuitive search experience (e.g., searching by title, author, keyword, or genre with effective filtering and sorting) is crucial for a good user experience but can be complex to implement efficiently, especially with a large catalog.

## Dev Notes:

### Previous Story Insights:
- User & Role Management (Story 1.1) is needed to define the 'Librarian' role and to identify patrons (students and teachers).
- Student & Teacher Management (Story 5.1) provides the core user data for library patrons.

### Data Models:
- **LibraryBooks Table:** To store the catalog of all books, including ISBN, title, author, genre, quantity, and availability status.
- **LibraryBorrowingRules Table:** To store tenant-specific rules (e.g., borrowing duration, max books per user).
- **LibraryCirculation Table:** A transaction log to record all book checkouts, returns, and renewals, linking a book to a user with dates.
- **LibraryFines Table:** To record fines owed by users for overdue or lost books.

## Role-Based Library Management Access Control:

### Super Admin:
- **Access Level**: System-wide read access to library data across all tenants
- **Permissions**: 
  - View library usage trends and patterns across all schools
  - Access system-wide library reports and analytics
  - Monitor library compliance and policies across tenants
- **Restrictions**: Cannot manage library operations or configure policies (delegated to tenant admins)

### Tenant Admin:
- **Access Level**: Full CRUD access within their tenant
- **Permissions**:
  - Configure library policies and borrowing rules
  - Manage library staff and librarian assignments
  - View all library data and generate comprehensive reports
  - Override library operations when necessary
  - Access all patron information and borrowing history
- **Restrictions**: Cannot access other tenants' library data

### Librarian:
- **Access Level**: Full library management within their assigned library
- **Permissions**:
  - Catalog and manage book collection
  - Process book circulation (checkout, return, renewal)
  - Manage library patrons and view borrowing history
  - Calculate and apply fines
  - Search and manage library catalog
- **Restrictions**: Cannot configure library policies or access other tenants' data

### Teacher:
- **Access Level**: Extended borrowing privileges, view own borrowing history
- **Permissions**:
  - Borrow books with extended limits and periods
  - View own borrowing history and current checkouts
  - Search library catalog
  - Renew borrowed books
- **Restrictions**: Cannot access library administration, other users' data, or manage circulation

### Student:
- **Access Level**: Basic borrowing privileges, view own borrowing history
- **Permissions**:
  - Borrow books within standard limits
  - View own borrowing history and current checkouts
  - Search library catalog
  - Renew borrowed books (if allowed by policy)
- **Restrictions**: Cannot access library administration, other users' data, or manage circulation

## Tasks / Subtasks:
- [x] Task 1 (AC: 1, 7): Implement CRUD operations for the book catalog and the user-facing search interface.
- [x] Task 2 (AC: 2): Develop the circulation workflow for issuing, returning, and renewing books.
- [x] Task 3 (AC: 3, 6): Implement the functionality for Librarians to configure borrowing rules and fine policies.
- [x] Task 4 (AC: 4): Create a system job or query to automatically identify and flag overdue books.
- [x] Task 5 (AC: 5): Implement the patron management view, showing user borrowing history and current checkouts.
- [x] Task 6 (AC: 8): Ensure strict tenant isolation (`tenant_id`) across all library-related database tables and APIs.
- [ ] Task 7 (AC: 9): Implement role-based access control for library management APIs.
- [ ] Task 8 (AC: 10): Create role-specific library dashboard components.
- [ ] Task 9 (AC: 11): Implement comprehensive library data filtering based on user roles.
- [ ] Task 10 (Future): Research and design the data structures needed for future barcode/RFID integration.
