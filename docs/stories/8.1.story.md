---
title: Dormitory Management
status: Draft
epic: 8
story: 1
---

# User Story: As a Dormitory Warden or Tenant Admin, I want to manage student dormitories, including room allocation and visitor tracking, to ensure efficient operations and student safety.

## Acceptance Criteria:
- The system shall allow a Tenant Admin to define and manage dormitories and the rooms within them (e.g., room number, capacity, type).
- The system shall support the assignment of students to specific rooms and beds.
- The system shall provide a real-time view of room and bed vacancy.
- The system shall allow for the management of student room transfers.
- The system shall include a visitor management feature to log visitors entering and leaving the dormitories.
- The system shall allow wardens or staff to be assigned to specific dormitories.
- All dormitory-related data, including room assignments and visitor logs, must be strictly isolated by tenant.

## Examples:
- **Room Allocation:** An admin needs to assign a new student, 'John Doe', to a room. They filter for vacant beds in 'Dormitory A' for his grade level, select 'Room 101, Bed B', and assign him. The room's occupancy status is immediately updated from 'Available' to 'Occupied'.
- **Visitor Log:** A parent arrives to visit their child. The dormitory warden on duty registers the visitor's name, who they are visiting, and the time of entry. When the parent leaves, the warden logs the time of exit. This creates a secure record of all visitors.

## Potential Obstacles:
- **Complex Allocation Rules:** Automating room allocation based on multiple constraints (e.g., grouping students by age, course, or handling roommate requests) is a complex algorithmic problem. The initial version should focus on a robust manual allocation system with clear vacancy visibility.
- **Real-time Vacancy Sync:** If multiple administrators are assigning rooms simultaneously, there is a risk of race conditions (e.g., two admins assigning the same bed). The system needs to use transactional operations or locking mechanisms to ensure data consistency.
- **Integration with Other Modules:** Linking dormitory fees to the Finance module, or linking disciplinary incidents within the dorm to a student's main profile, will require careful planning of inter-module communication and data flow.

## Dev Notes:

### Previous Story Insights:
- Student & Teacher Management (Story 5.1) provides the core student data for room assignments.
- User & Role Management (Story 1.1) is necessary to define roles like 'Dormitory Warden' with specific permissions.

### Data Models:
- **Dormitories Table:** To store information about each dormitory building.
- **Rooms Table:** To store details of each room within a dormitory, including its capacity and type.
- **Beds Table:** To define the specific beds within a room, which will be the assignable unit.
- **StudentDormitoryAssignments Table:** A join table that maps a student to a specific bed for an academic year.
- **VisitorLogs Table:** To record all visitor information, including the student being visited and entry/exit times.

## Tasks / Subtasks:
- [ ] Task 1 (AC: 1, 6): Implement CRUD operations for managing dormitories, rooms, beds, and warden assignments.
- [ ] Task 2 (AC: 2, 4): Develop the workflow for assigning students to beds and managing room transfers.
- [ ] Task 3 (AC: 3): Create a dashboard or visual interface to show real-time dormitory occupancy and bed availability.
- [ ] Task 4 (AC: 5): Build the visitor management module for logging visitor entries and exits.
- [ ] Task 5 (AC: 7): Ensure strict tenant isolation (`tenant_id`) is applied to all database queries and API endpoints in this module.
- [ ] Task 6 (UI/UX): Design an intuitive interface for visualizing dormitory layouts and assignments (Stretch Goal).
